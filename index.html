<!DOCTYPE html>
<html lang="es" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard | Datos de personas</title>

    <!-- Bootstrap 5.3 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Leaflet (OpenStreetMap) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <style>
      :root {
        /* Colores de marca */
        --brand-green: #11875d;
        --brand-green-light: #b9e4cf;
        --brand-ink: #0f2b25;
        --brand-bg: #f5fbf8;
      }
      body {
        background: radial-gradient(
              1200px 600px at 20% -10%,
              var(--brand-green-light) 0%,
              transparent 60%
            )
            no-repeat,
          radial-gradient(1200px 600px at 120% 10%, #e9fff6 0%, transparent 50%)
            no-repeat,
          var(--brand-bg);
      }
      .brand-gradient {
        background: linear-gradient(135deg, var(--brand-green), #16a874);
      }
      .text-brand {
        color: var(--brand-green);
      }
      .btn-brand {
        --bs-btn-color: #fff;
        --bs-btn-bg: var(--brand-green);
        --bs-btn-border-color: var(--brand-green);
        --bs-btn-hover-bg: #0f6f4c;
        --bs-btn-hover-border-color: #0f6f4c;
        --bs-btn-focus-shadow-rgb: 17, 135, 93;
      }
      .card {
        border: 1px solid rgba(17, 135, 93, 0.12);
        box-shadow: 0 6px 24px rgba(17, 135, 93, 0.08);
        border-radius: 1rem;
      }
      header.navbar {
        backdrop-filter: blur(8px);
        background: rgba(255, 255, 255, 0.85);
        border-bottom: 1px solid rgba(17, 135, 93, 0.12);
      }
      .hero-figure {
        max-width: 520px;
        border-radius: 1rem;
        box-shadow: 0 16px 50px rgba(17, 135, 93, 0.18);
      }
      #map {
        height: 420px;
        border-radius: 1rem;
        overflow: hidden;
        border: 1px solid rgba(17, 135, 93, 0.2);
      }
      .section-anchor {
        scroll-margin-top: 80px; /* para navegar con anclas bajo navbar fija */
      }
      .form-success {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- ===================== Header / Navbar ===================== -->
    <header class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a
          class="navbar-brand fw-bold d-flex align-items-center gap-2"
          href="#"
        >
          <span class="badge rounded-pill brand-gradient"> </span>
          <span class="text-brand">PeopleDash</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#nav"
          aria-controls="nav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <nav id="nav" class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="#s1">Datos de personas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#s2">Gráfica y lista</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="#s3">Mapa</a></li>
            <li class="nav-item">
              <a class="nav-link" href="#s4">Formulario</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#footer">Contacto</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="mt-5 pt-4">
      <!-- ===================== Sección 1: Título + resumen + imagen ===================== -->
      <section id="s1" class="section-anchor container py-5">
        <div class="row align-items-center g-4">
          <div class="col-lg-6">
            <span
              class="badge rounded-pill bg-success-subtle text-success-emphasis px-3 py-2 mb-3"
            >
              Dashboard
            </span>
            <h1 class="display-5 fw-bold mb-3 text-ink">Datos de personas</h1>
            <p class="lead mb-4">
              Este panel centraliza información de personas y la presenta de
              forma clara: un resumen visual con una
              <strong class="text-brand">gráfica de barras</strong>, un
              <strong class="text-brand">listado</strong> con datos básicos y un
              <strong class="text-brand">mapa interactivo</strong> con sus
              ubicaciones aproximadas. Los datos provienen de APIs (simuladas en
              esta demo).
            </p>
            <div class="d-flex gap-2">
              <a href="#s2" class="btn btn-brand btn-lg">Ver datos</a>
              <a href="#s4" class="btn btn-outline-success btn-lg"
                >Enviar información</a
              >
            </div>
          </div>
          <div class="col-lg-6 text-center">
            <!-- Imagen decorativa (puedes reemplazar src por una tuya) -->
            <img
              class="img-fluid hero-figure"
              src="https://images.unsplash.com/photo-1606857521015-7f9fcf423740?q=80&w=1600&auto=format&fit=crop"
              alt="Ilustración de tablero de datos en tonos verdes"
            />
          </div>
        </div>
      </section>

      <!-- ===================== Sección 2: Gráfica de barras + Lista de personas ===================== -->
      <section id="s2" class="section-anchor container py-5">
        <div class="row g-4">
          <div class="col-lg-7">
            <div class="card h-100">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h2 class="h4 mb-1">Distribución por categoría</h2>
                    <p class="text-secondary mb-0">
                      Datos desde API (fake) con estructura
                      <code>{ id, label, value }</code>.
                    </p>
                  </div>
                  <button
                    id="reloadChart"
                    class="btn btn-outline-success btn-sm"
                  >
                    Recargar datos
                  </button>
                </div>
                <canvas
                  id="barChart"
                  height="140"
                  aria-label="Gráfica de barras"
                ></canvas>
              </div>
            </div>
          </div>

          <div class="col-lg-5">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <div
                  class="d-flex justify-content-between align-items-start mb-3"
                >
                  <div>
                    <h2 class="h4 mb-1">Personas</h2>
                    <p class="text-secondary mb-0">
                      Listado desde API (fake)
                      <code>{ id, nombre, edad }</code>.
                    </p>
                  </div>
                  <button
                    id="reloadPeople"
                    class="btn btn-outline-success btn-sm"
                  >
                    Refrescar
                  </button>
                </div>
                <div
                  id="peopleList"
                  class="list-group list-group-flush flex-grow-1 overflow-auto"
                  style="max-height: 320px"
                >
                  <!-- Rellenado por JS -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ===================== Sección 3: Mapa OSM con puntos ===================== -->
      <section id="s3" class="section-anchor container py-5">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h2 class="h4 mb-1">Mapa de ubicaciones</h2>
                <p class="text-secondary mb-0">
                  Puntos (fake):
                  <code>{ id, titulo, descripcion, latitud, longitud }</code>.
                </p>
              </div>
              <button id="reloadMap" class="btn btn-outline-success btn-sm">
                Recargar puntos
              </button>
            </div>
            <div
              id="map"
              role="region"
              aria-label="Mapa de OpenStreetMap"
            ></div>
          </div>
        </div>
      </section>

      <!-- ===================== Sección 4: Formulario (POST AJAX) ===================== -->
      <section id="s4" class="section-anchor container py-5">
        <div class="card">
          <div class="card-body">
            <h2 class="h4 mb-3">Enviar información</h2>
            <p class="text-secondary">
              El formulario envía datos a una API (fake) con
              <strong>POST AJAX</strong>. Al recibir la respuesta, aparece un
              mensaje de éxito. Puedes volver a usarlo con el botón
              <em>“Nuevo envío”</em>.
            </p>

            <form id="infoForm" class="row g-3">
              <div class="col-md-4">
                <label for="fNombre" class="form-label">Nombre</label>
                <input
                  type="text"
                  class="form-control"
                  id="fNombre"
                  name="nombre"
                  placeholder="Tu nombre"
                  required
                />
              </div>
              <div class="col-md-4">
                <label for="fEmail" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="fEmail"
                  name="email"
                  placeholder="tunombre@correo.com"
                  required
                />
              </div>
              <div class="col-md-4">
                <label for="fAsunto" class="form-label">Asunto</label>
                <input
                  type="text"
                  class="form-control"
                  id="fAsunto"
                  name="asunto"
                  placeholder="Motivo del contacto"
                  required
                />
              </div>
              <div class="col-12">
                <label for="fMensaje" class="form-label">Mensaje</label>
                <textarea
                  class="form-control"
                  id="fMensaje"
                  name="mensaje"
                  rows="4"
                  placeholder="Escribe tu mensaje..."
                  required
                ></textarea>
              </div>

              <div class="col-12 d-flex gap-2">
                <button class="btn btn-brand" type="submit">Enviar</button>
                <button
                  id="btnNuevo"
                  class="btn btn-outline-success"
                  type="button"
                >
                  Nuevo envío
                </button>
              </div>
            </form>

            <div
              id="formSuccess"
              class="alert alert-success mt-4 form-success"
              role="alert"
            >
              ✅ ¡Tu información se envió correctamente! Gracias por
              contactarnos.
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ===================== Footer ===================== -->
    <footer id="footer" class="mt-5 py-4 border-top">
      <div class="container">
        <div class="row gy-3 align-items-center">
          <div class="col-md">
            <span class="fw-semibold text-brand">PeopleDash</span> · Proyecto
            demo
          </div>
          <div class="col-md text-md-center">
            <small
              >Contacto:
              <a href="mailto:contacto@peopledash.example" class="link-success"
                >contacto@peopledash.example</a
              ></small
            >
          </div>
          <div class="col-md text-md-end">
            <small
              >&copy; <span id="year"></span> Todos los derechos
              reservados.</small
            >
          </div>
        </div>
      </div>
    </footer>

    <!-- ===================== JS ===================== -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      /* -------------------------------------------------------
   APIs FAKE (simuladas con fetch + setTimeout)
--------------------------------------------------------*/
      function apiGet(url) {
        return new Promise((resolve) => {
          setTimeout(() => {
            if (url.endsWith("/chart")) {
              // { id:number, label:string, value:number }
              resolve([
                { id: 1, label: "A", value: 12 },
                { id: 2, label: "B", value: 19 },
                { id: 3, label: "C", value: 7 },
                { id: 4, label: "D", value: 14 },
                { id: 5, label: "E", value: 9 },
              ]);
            } else if (url.endsWith("/people")) {
              // { id, nombre, edad }
              resolve([
                { id: 101, nombre: "Ana Torres", edad: 28 },
                { id: 102, nombre: "Bruno Martínez", edad: 34 },
                { id: 103, nombre: "Carla López", edad: 22 },
                { id: 104, nombre: "Diego Ramírez", edad: 41 },
                { id: 105, nombre: "Elena Castillo", edad: 30 },
                { id: 106, nombre: "Fernando Ortiz", edad: 26 },
                { id: 107, nombre: "Gloria Álvarez", edad: 33 },
              ]);
            } else if (url.endsWith("/points")) {
              // { id, titulo, descripcion, latitud, longitud }
              resolve([
                {
                  id: 1,
                  titulo: "Ana T.",
                  descripcion: "Zona norte",
                  latitud: 19.4978,
                  longitud: -99.1269,
                },
                {
                  id: 2,
                  titulo: "Bruno M.",
                  descripcion: "Zona centro",
                  latitud: 19.4326,
                  longitud: -99.1332,
                },
                {
                  id: 3,
                  titulo: "Carla L.",
                  descripcion: "Zona poniente",
                  latitud: 19.3654,
                  longitud: -99.2033,
                },
                {
                  id: 4,
                  titulo: "Diego R.",
                  descripcion: "Zona sur",
                  latitud: 19.305,
                  longitud: -99.15,
                },
                {
                  id: 5,
                  titulo: "Elena C.",
                  descripcion: "Zona oriente",
                  latitud: 19.44,
                  longitud: -99.08,
                },
              ]);
            } else {
              resolve([]);
            }
          }, 500);
        });
      }

      function apiPost(url, payload) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              ok: true,
              received: payload,
              timestamp: new Date().toISOString(),
            });
          }, 700);
        });
      }

      /* -------------------------------------------------------
   Utilidades UI
--------------------------------------------------------*/
      const yearEl = document.getElementById("year");
      if (yearEl) {
        yearEl.textContent = new Date().getFullYear();
      }

      /* -------------------------------------------------------
   Sección 2: Gráfica de barras + Lista
--------------------------------------------------------*/
      let chartInstance = null;

      async function loadChart() {
        const data = await apiGet("/api/chart");
        const labels = data.map((d) => d.label);
        const values = data.map((d) => d.value);

        const ctx = document.getElementById("barChart");
        if (chartInstance) {
          chartInstance.data.labels = labels;
          chartInstance.data.datasets[0].data = values;
          chartInstance.update();
          return;
        }

        chartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels,
            datasets: [
              {
                label: "Valor",
                data: values,
                backgroundColor: "rgba(17,135,93,0.35)",
                borderColor: "rgba(17,135,93,1)",
                borderWidth: 1,
                borderRadius: 8,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => ` ${ctx.raw}`,
                },
              },
            },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 5 } },
            },
          },
        });
      }

      async function loadPeople() {
        const listEl = document.getElementById("peopleList");
        listEl.innerHTML =
          '<div class="text-center py-3 text-secondary">Cargando...</div>';
        const people = await apiGet("/api/people");
        if (!people.length) {
          listEl.innerHTML =
            '<div class="text-center py-3 text-secondary">Sin registros</div>';
          return;
        }
        listEl.innerHTML = "";
        people.forEach((p) => {
          const item = document.createElement("a");
          item.href = "#";
          item.className =
            "list-group-item list-group-item-action d-flex justify-content-between align-items-center";
          item.innerHTML = `
      <div>
        <div class="fw-semibold">${p.nombre}</div>
        <small class="text-secondary">ID: ${p.id}</small>
      </div>
      <span class="badge text-bg-success-subtle text-success-emphasis">Edad: ${p.edad}</span>
    `;
          listEl.appendChild(item);
        });
      }

      document
        .getElementById("reloadChart")
        .addEventListener("click", loadChart);
      document
        .getElementById("reloadPeople")
        .addEventListener("click", loadPeople);

      /* -------------------------------------------------------
   Sección 3: Mapa (Leaflet + OSM)
--------------------------------------------------------*/
      let leafletMap = null;
      let markerLayer = null;

      function ensureMap() {
        if (leafletMap) return;
        leafletMap = L.map("map", { zoomControl: true }).setView(
          [19.4326, -99.1332],
          11
        );
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution: "&copy; OpenStreetMap",
        }).addTo(leafletMap);
        markerLayer = L.layerGroup().addTo(leafletMap);
      }

      async function loadMapPoints() {
        ensureMap();
        markerLayer.clearLayers();
        const points = await apiGet("/api/points");
        points.forEach((pt) => {
          const marker = L.marker([pt.latitud, pt.longitud]).addTo(markerLayer);
          marker.bindPopup(
            `<strong>${pt.titulo}</strong><br/><small>${pt.descripcion}</small>`
          );
        });
        // Ajuste de vista a marcadores
        const group = L.featureGroup(markerLayer.getLayers());
        try {
          leafletMap.fitBounds(group.getBounds().pad(0.2));
        } catch (e) {}
      }

      document
        .getElementById("reloadMap")
        .addEventListener("click", loadMapPoints);

      /* -------------------------------------------------------
   Sección 4: Formulario (POST AJAX)
--------------------------------------------------------*/
      const form = document.getElementById("infoForm");
      const successBox = document.getElementById("formSuccess");
      const btnNuevo = document.getElementById("btnNuevo");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const payload = Object.fromEntries(fd.entries());

        // Deshabilita mientras envía
        [...form.elements].forEach((el) => (el.disabled = true));

        const res = await apiPost("/api/send", payload);

        if (res?.ok) {
          successBox.style.display = "block";
        } else {
          successBox.classList.replace("alert-success", "alert-danger");
          successBox.textContent = "Ocurrió un error al enviar.";
          successBox.style.display = "block";
        }
      });

      btnNuevo.addEventListener("click", () => {
        form.reset();
        successBox.style.display = "none";
        successBox.classList.remove("alert-danger");
        successBox.classList.add("alert-success");
        [...form.elements].forEach((el) => (el.disabled = false));
      });

      /* -------------------------------------------------------
   Inicio
--------------------------------------------------------*/
      document.addEventListener("DOMContentLoaded", async () => {
        await loadChart();
        await loadPeople();
        await loadMapPoints();
      });
    </script>
  </body>
</html>
